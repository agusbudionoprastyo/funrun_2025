<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction Data</title>

    <!-- jQuery Library -->
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>

    <!-- Flowbite JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@9.0.3"></script>
</head>
<body>
    <table id="search-table">
        <thead>
            <tr>
                <th>Transaction ID</th>
                <th>Total Amount</th>
                <th>Payment Proof</th>
                <th>Transaction Date</th>
                <th>Status</th>
                <th>User Details</th>
            </tr>
        </thead>
        <tbody>
            <!-- Rows will be inserted here dynamically -->
        </tbody>
    </table>

    <!-- Initialize DataTables -->
    <script>
        $(document).ready(function() {
            if (document.getElementById("search-table") && typeof simpleDatatables.DataTable !== 'undefined') {
                const dataTable = new simpleDatatables.DataTable("#search-table", {
                    searchable: true,
                    sortable: false
                });

                // Fetch data via AJAX
                $.ajax({
                    url: 'get_transactions.php', // Update this URL if needed
                    method: 'GET',
                    success: function(data) {
                        if (data.length > 0) {
                            // Populate the table with data
                            let tableRows = '';
                            data.forEach(function(row) {
                                let statusClass = row.badge_class;
                                tableRows += `
                                    <tr>
                                        <td>${row.transaction_id}</td>
                                        <td>${row.total_amount}</td>
                                        <td>
                                            <a href="users/paymentprooft/${row.payment_prooft}" target="_blank">
                                                <img alt="Image placeholder" src="users/paymentprooft/${row.payment_prooft}" class="avatar rounded-circle" />
                                            </a>
                                        </td>
                                        <td>${row.transaction_date}</td>
                                        <td>
                                            <span class="badge badge-dot mr-4">
                                                <i class="${statusClass}"></i>${row.status}
                                            </span>
                                        </td>
                                        <td>
                                            ${row.name_1} ${row.name_2 ? ' / ' + row.name_2 : ''}<br>
                                            ${row.email_1} ${row.email_2 ? ' / ' + row.email_2 : ''}<br>
                                            ${row.phone_1} ${row.phone_2 ? ' / ' + row.phone_2 : ''}
                                        </td>
                                    </tr>
                                `;
                            });

                            // Append the generated rows to the table body
                            $('#search-table tbody').html(tableRows); 
                        }
                    },
                    error: function() {
                        alert('Error fetching data');
                    }
                });
            }
        });
    </script>
</body>
</html>
